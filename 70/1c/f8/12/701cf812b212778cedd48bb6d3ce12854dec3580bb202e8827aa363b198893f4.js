(function(){var e,t,a,n,r,i,l,u,o,c,h,g,d,f;c=["text","color","alpha","space","size"],o={},u=(e=function(e){return document.querySelector(e)})("#image"),l=e("#graph"),r=null,t=null,f=null,d=null,a=function(e){var t,a,n,r,i,l;for(i=(a=atob(e.split(",")[1])).length,t=new Uint8Array(i),n=r=0,l=i-1;0<=l?r<=l:r>=l;n=0<=l?++r:--r)t[n]=a.charCodeAt(n);return new Blob([t],{type:"image/png"})},i=function(){var e,t;return t=function(e){return e<10?"0"+e:e},(e=new Date).getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())+".png"},g=function(){var e;if(null!=r)return(e=new FileReader).onload=function(){var r;return(r=new Image).onload=function(){var e;return(t=document.createElement("canvas")).width=r.width,t.height=r.height,f=null,(e=t.getContext("2d")).drawImage(r,0,0),d=function(){return e.rotate(315*Math.PI/180),e.clearRect(0,0,t.width,t.height),e.drawImage(r,0,0),e.rotate(45*Math.PI/180)},n(),l.innerHTML="",l.appendChild(t),t.addEventListener("click",(function(){var e,n,r;return(r=document.createElement("a")).download=i(),n=t.toDataURL("image/png"),e=a(n),r.href=URL.createObjectURL(e),l.appendChild(r),setTimeout((function(){return r.click(),l.removeChild(r)}),100)}))},r.src=e.result},e.readAsDataURL(r)},h=function(){var e;return e=o.color.value.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i),"rgba("+parseInt(e[1],16)+","+parseInt(e[2],16)+","+parseInt(e[3],16)+","+o.alpha.value+")"},n=function(){var e,a,n,r,i,l,u,c,g,s,p,v,m;if(null!=t)for(s=o.size.value*Math.max(15,Math.min(t.width,t.height)/25),null!=f?d():(f=t.getContext("2d")).rotate(45*Math.PI/180),f.fillStyle=h(),f.font="bold "+s+'px -apple-system,"Helvetica Neue",Helvetica,Arial,"PingFang SC","Hiragino Sans GB","WenQuanYi Micro Hei",sans-serif',p=f.measureText(o.text.value).width,g=Math.sqrt(Math.pow(t.width,2)+Math.pow(t.height,2)),i=f.measureText("啊").width,v=Math.ceil(g/(p+i)),m=Math.ceil(g/(o.space.value*s)/2),e=n=0,l=v;0<=l?n<=l:n>=l;e=0<=l?++n:--n)for(a=r=u=-m,c=m;u<=c?r<=c:r>=c;a=u<=c?++r:--r)f.fillText(o.text.value,(p+i)*e,o.space.value*s*a)},u.addEventListener("change",(function(){var e;return"image/png"!==(e=(r=this.files[0]).type)&&"image/jpeg"!==e&&"image/gif"!==e?alert("仅支持 png, jpg, gif 图片格式"):g()})),c.forEach((function(t){var a;return a=e("#"+t),o[t]=a,a.addEventListener("input",n)}))}).call(this);